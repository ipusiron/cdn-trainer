<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CDN Trainer</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="header-content">
      <h1>CDN Trainer</h1>
      <div class="header-buttons">
        <button id="helpToggle" class="help-toggle" title="ヘルプを表示">
          ❓
        </button>
        <button id="darkModeToggle" class="dark-mode-toggle" title="ダークモード切り替え">
          <span class="light-icon">☀️</span>
          <span class="dark-icon">🌙</span>
        </button>
      </div>
    </div>
    <p class="subtitle">
      攻撃者から見えるサーバーの姿とは？<br />
      CDN・WAF・オリジン構成の違いを体験しながら学べます。
    </p>
  </header>

  <main>
    <section class="custom-config">
      <h2>🛠 カスタム構成モード</h2>
      <form id="configForm">
        <label class="tooltip-container">
          <input type="checkbox" id="cdn" checked /> CDN を有効にする
          <span class="tooltip">
            <strong>CDN (Content Delivery Network)</strong><br>
            世界中のサーバーからコンテンツを配信。DDoS攻撃の緩和やパフォーマンス向上に効果的で、攻撃の第一防御線として機能します。
          </span>
        </label><br />
        <label class="tooltip-container">
          <input type="checkbox" id="waf" checked /> WAF を有効にする
          <span class="tooltip">
            <strong>WAF (Web Application Firewall)</strong><br>
            SQLインジェクション、XSSなどのアプリケーション層攻撃を検知・防御。シグネチャベースで悪意のあるリクエストをブロックします。
          </span>
        </label><br />
        <label class="tooltip-container">
          <input type="checkbox" id="iplimit" checked /> Origin にIP制限をかける
          <span class="tooltip">
            <strong>IP制限 (IP Restriction)</strong><br>
            特定のIPアドレス（CDN経由など）のみにアクセスを許可。CDNバイパス攻撃を防ぐ最後の防御線で、オリジンサーバーを直接攻撃から守ります。
          </span>
        </label><br />
        <button type="button" onclick="evaluateConfig()" class="tooltip-container">
          構成を診断する
          <span class="tooltip">
            選択した構成でセキュリティ評価を実行し、攻撃フローをアニメーションで表示します。
          </span>
        </button>
      </form>
    </section>

    <section class="diagram-section">
      <h2 class="tooltip-container">
        構成図
        <span class="tooltip">
          ネットワーク構成と攻撃フローをSVGアニメーションで表示。紅色の攻撃アイコンがどこでブロックされるか、または通過するかを視覚的に確認できます。
        </span>
      </h2>
      <div id="diagram" class="diagram-box"></div>
    </section>

    <section class="diagnosis-section">
      <h2 class="tooltip-container">
        診断コメント
        <span class="tooltip">
          選択した構成のセキュリティレベル、リスク、改善提案を表示します。各防御策の有効性と問題点を説明します。
        </span>
      </h2>
      <div id="diagnosis" class="diagnosis-box"></div>
    </section>

    <section class="pattern-toggle-section">
      <label class="toggle-switch tooltip-container">
        <input type="checkbox" id="patternToggle">
        <span class="slider"></span>
        <span class="toggle-label">8パターンの評価一覧を表示</span>
        <span class="tooltip">
          CDN/WAF/IP制限のすべての組み合わせ（8パターン）のセキュリティ評価を一覧表で表示します。各パターンのスコアやブロック位置を比較できます。
        </span>
      </label>
    </section>

    <section class="pattern-table-section" id="patternTableSection">
      <div class="pattern-table-content">
        <h2>📋 8パターンのセキュリティ評価一覧</h2>
        <table class="pattern-table">
        <thead>
          <tr>
            <th>CDN</th>
            <th>WAF</th>
            <th>IP制限</th>
            <th>評価</th>
            <th>レベル</th>
            <th>ブロック位置</th>
          </tr>
        </thead>
        <tbody>
          <tr class="level-best">
            <td>✅</td>
            <td>✅</td>
            <td>✅</td>
            <td>3/3</td>
            <td>最高</td>
            <td>WAFでブロック</td>
          </tr>
          <tr class="level-high">
            <td>✅</td>
            <td>✅</td>
            <td>❌</td>
            <td>2/3</td>
            <td>高い</td>
            <td>WAFでブロック</td>
          </tr>
          <tr class="level-high">
            <td>✅</td>
            <td>❌</td>
            <td>✅</td>
            <td>2/3</td>
            <td>高い</td>
            <td>CDNでブロック</td>
          </tr>
          <tr class="level-high">
            <td>❌</td>
            <td>✅</td>
            <td>✅</td>
            <td>2/3</td>
            <td>高い</td>
            <td>WAFでブロック</td>
          </tr>
          <tr class="level-low">
            <td>✅</td>
            <td>❌</td>
            <td>❌</td>
            <td>1/3</td>
            <td>低い</td>
            <td>CDNでブロック</td>
          </tr>
          <tr class="level-low">
            <td>❌</td>
            <td>✅</td>
            <td>❌</td>
            <td>1/3</td>
            <td>低い</td>
            <td>WAFでブロック</td>
          </tr>
          <tr class="level-low">
            <td>❌</td>
            <td>❌</td>
            <td>✅</td>
            <td>1/3</td>
            <td>低い</td>
            <td>IP制限でブロック</td>
          </tr>
          <tr class="level-worst">
            <td>❌</td>
            <td>❌</td>
            <td>❌</td>
            <td>0/3</td>
            <td>最低</td>
            <td>ブロックできない💥</td>
          </tr>
        </tbody>
      </table>
      </div>
    </section>
  </main>

  <!-- ヘルプモーダル -->
  <div id="helpModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>📚 CDN Trainer ヘルプ</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body">
        <h3>🎯 このツールについて</h3>
        <p>CDN Trainerは、セキュリティ教育を目的としたWebツールです。CDN・WAF・オリジンサーバーの構成の違いを体験的に学ぶことができます。</p>
        
        <h3>🛠 使い方</h3>
        <ol>
          <li><strong>構成選択</strong>：CDN・WAF・IP制限のチェックボックスを選択します</li>
          <li><strong>診断実行</strong>：「構成を診断する」ボタンを押します</li>
          <li><strong>結果確認</strong>：構成図と診断コメントでセキュリティレベルを確認します</li>
        </ol>
        
        <h3>🔍 用語解説</h3>
        <dl>
          <dt><strong>CDN (Content Delivery Network)</strong></dt>
          <dd>世界中の中継サーバーがコンテンツを配信する仕組み。攻撃の盾としても機能します。</dd>
          
          <dt><strong>WAF (Web Application Firewall)</strong></dt>
          <dd>SQLインジェクションなどのWebアプリへの攻撃を検知・防御するセキュリティ機能です。</dd>
          
          <dt><strong>オリジンサーバー</strong></dt>
          <dd>あなたの本来のWebサーバー。CDNの背後にある実際のサーバーです。</dd>
          
          <dt><strong>IP制限</strong></dt>
          <dd>特定のIPアドレス（CDN経由など）のみにアクセスを許可する技術です。</dd>
        </dl>
        
        <h3>⭐ セキュリティレベル</h3>
        <ul>
          <li><strong>最高 (3/3)</strong>：CDN・WAF・IP制限すべて有効</li>
          <li><strong>高い (2/3)</strong>：3つのうち2つが有効</li>
          <li><strong>低い (1/3)</strong>：3つのうち1つのみ有効</li>
          <li><strong>最低 (0/3)</strong>：すべて無効（危険）</li>
        </ul>
        
        <h3>🎨 機能</h3>
        <ul>
          <li><strong>アニメーション表示</strong>：攻撃の流れとブロック位置を視覚化</li>
          <li><strong>8パターン一覧</strong>：トグルスイッチですべての組み合わせを確認</li>
          <li><strong>ダークモード</strong>：☀️/🌙ボタンで明暗切り替え</li>
          <li><strong>レスポンシブ対応</strong>：スマートフォンでも使用可能</li>
        </ul>
        
        <h3>🚨 学習のポイント</h3>
        <p><strong>重要</strong>：CDNを使用していてもWAFが無効だと、オリジンサーバーに直接アクセスされた場合（CDNバイパス）にアプリ層攻撃を防げません。複数の防御レイヤーを組み合わせることが重要です。</p>
      </div>
    </div>
  </div>

  <footer>
    <div class="footer">
      🔗 GitHubリポジトリはこちら（
      <a href="https://github.com/ipusiron/cdn-trainer" target="_blank">
        ipusiron/cdn-trainer
      </a>）
    </div>
  </footer>

  <script src="script.js"></script>
</body>
</html>
